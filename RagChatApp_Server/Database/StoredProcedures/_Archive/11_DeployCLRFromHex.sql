-- =============================================
-- Deploy SQL CLR Vector Functions (From Hex)
-- =============================================
USE [OSL_AI]
GO

PRINT 'Deploying SqlVectorFunctions assembly from hexadecimal...';
PRINT 'Assembly size: 6656 bytes';
GO

-- Drop existing if present
IF EXISTS (SELECT * FROM sys.assemblies WHERE name = 'SqlVectorFunctions')
BEGIN
    DROP ASSEMBLY SqlVectorFunctions;
    PRINT 'Dropped existing assembly';
END
GO

-- Create assembly from hexadecimal
CREATE ASSEMBLY SqlVectorFunctions
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103003B0265C20000000000000000E00022200B013000001200000006000000000000E23000000020000000400000000000100020000000020000040000000000000006000000000000000080000000020000000000000300608500001000001000000000100000100000000000001000000000000000000000008D3000004F00000000400000D403000000000000000000000000000000000000006000000C0000009C2F0000540000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000E8100000002000000012000000020000000000000000000000000000200000602E72737263000000D4030000004000000004000000140000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000001800000000000000000000000000004000004200000000000000000000000000000000C13000000000000048000000020005002C230000700C00000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000133003003801000001000011026F0C00000A2D08036F0C00000A2C067E0D00000A2A026F0E00000A0A036F0E00000A0B068E2C04078E2D067E0D00000A2A068E69078E692E067E0D00000A2A068E691A5D2C067E0D00000A2A068E691A5B0C2300000000000000000D230000000000000000130423000000000000000013051613072B3F11071A5A1308061108280F00000A1309071108280F00000A130A091109110A5A6C580D1104110911095A6C5813041105110A110A5A6C58130511071758130711070832BC1104281000000A13041105281000000A130511042300000000000000002E0D1105230000000000000000330F230000000000000000281100000A2A09110411055A5B1306110623000000000000F03F360B23000000000000F03F1306110623000000000000F0BF340B23000000000000F0BF13061106731200000A2A13300400D100000002000011026F0C00000A2C067E1300000A2A026F0E00000A0A068E2C07068E691A5D2C0B7201000070731400000A2A068E691A5B0B0F01281500000A2D0F0F01281600000A07281700000A2B081F0A07281700000A0C088D170000010D1613052B220611051A5A280F00000A130609110512067225000070281800000AA211051758130511050832D9722B000070722F00007009281900000A281A00000A130408072F1B11047235000070078C19000001281B00000A281A00000A13042B0E1104725B000070281A00000A13041104731400000A2A000000133002003100000003000011026F0C00000A2C067E1C00000A2A026F0E00000A0A068E2C07068E691A5D2C067E1C00000A2A068E691A5B731D00000A2A000000133003006400000004000011026F0C00000A2C067E1E00000A2A026F0E00000A0A068E2D067E1E00000A2A068E691A5D2C067E1E00000A2A068E691A5B0B160C2B2406081A5A280F00000A0D09281F00000A2D0809282000000A2C067E1E00000A2A0817580C080732D87E2100000A2A1E02282200000A2A42534A4201000100000000000C00000076342E302E33303331390000000005006C000000D0020000237E00003C0300005403000023537472696E677300000000900600006000000023555300F0060000100000002347554944000000000700007005000023426C6F620000000000000002000001471502000900000000FA0133001600000100000019000000020000000500000006000000220000000E0000000400000001000000020000000000020201000000000006002D01A50206007F01A5020600720092020F00C502000006009D00C7010600660152020600F90052020600B60052020600D300520206004D01520206008600520206001D0324020A00180171020A004A0071020A00440071020A005900D4020A00E902D4020A00E101D4020A000C00D4020A002B02D4020600640224020600FD0124020600F601240206006500240206000F002402000000002000000000000100010001001000FC020000310001000100502000000000960040039E0001009421000000009600EB01A700030074220000000096003F02B0000500B422000000009600AC01B700060024230000000086188C020600070000000100010000000200150000000100BD0100000200F20200000100BD0100000100BD0109008C02010011008C02060019008C020A0029008C02100031008C02100039008C02100041008C02100049008C02100051008C02100059008C02100069008C02060089001902250081001F02290089009D012D00A90063003200B10030033900810024033E0081008C02440091001F02550091008C02100099001902250099009D015900B10036025D00C100F4016300B9003A026800B9000F036F00B9001603750099001F02800099008C020100A1006C008C00C10029009000C10035039000A100A7018C0061008C02060020005B00A3012E000B00BE002E001300C7002E001B00E6002E002300EF002E002B003D012E00330055012E003B0062012E0043006F012E004B003D012E0053003D0140005B00060360005B00D30380005B00A104150049007B008400048000000100000000000000000000000000FC02000004000000000000000000000095003B000000000004000000000000000000000095002F00000000000000000000656D62656464696E67310053716C496E74333200656D62656464696E6732003C4D6F64756C653E0049734E614E0053797374656D2E44617461006D73636F726C69620053797374656D446174614163636573734B696E640053716C446F75626C6500546F53696E676C650046616C73650044656275676761626C6541747472696275746500417373656D626C795469746C65417474726962757465005461726765744672616D65776F726B41747472696275746500417373656D626C7946696C6556657273696F6E41747472696275746500417373656D626C79496E666F726D6174696F6E616C56657273696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E4174747269627574650053716C46756E6374696F6E41747472696275746500436F6D70696C6174696F6E52656C61786174696F6E7341747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F6D70616E794174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465006765745F56616C7565005472756500497356616C6964456D62656464696E6700656D62656464696E670053797374656D2E52756E74696D652E56657273696F6E696E670053716C537472696E6700456D62656464696E67546F537472696E67004D6174680053716C566563746F7246756E6374696F6E732E646C6C006765745F49734E756C6C0053797374656D0053716C426F6F6C65616E004D696E004A6F696E00456D62656464696E6744696D656E73696F6E0053797374656D2E5265666C656374696F6E00426974436F6E766572746572004D6963726F736F66742E53716C5365727665722E536572766572002E63746F720053797374656D2E446961676E6F73746963730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F6465730053797374656D2E446174612E53716C54797065730053716C4279746573006D617856616C7565730053716C566563746F7246756E6374696F6E7300436F6E63617400466F726D6174004F626A656374006F705F496D706C696369740053717274004973496E66696E69747900436F73696E6553696D696C617269747900000000002349006E00760061006C0069006400200065006D00620065006400640069006E00670000054600360000035B0000052C00200000252C0020002E002E002E00200028007B0030007D00200074006F00740061006C0029005D0000035D0000003A8F0C5A0F96BB419B0D3164E032D00100042001010803200001052001011111042001010E0F070B1D051D05080D0D0D0D08080C0C03200002030611410420001D050600020C1D05080400010D0D05000111410D042001010D0B07071D0508081D0E0E080C03061149032000080500020808080420010E0E0600020E0E1D0E0500020E0E0E0500020E0E1C0407011D050306114D0707041D0508080C03061151040001020C08B77A5C561934E08908000211411245124508000211491245114D060001114D1245060001115112450801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010801000200000000004D01001C2E4E45544672616D65776F726B2C56657273696F6E3D76342E372E320100540E144672616D65776F726B446973706C61794E616D65142E4E4554204672616D65776F726B20342E372E321701001253716C566563746F7246756E6374696F6E7300000C01000752656C6561736500000C010007312E302E302E3000003301002E312E302E302B343438633038333064316137626662356231623530313933353331663263616462393764303165660000816101000500540E044E616D6513666E5F436F73696E6553696D696C617269747954020F497344657465726D696E697374696301540209497350726563697365005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D342E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000054557F4D6963726F736F66742E53716C5365727665722E5365727665722E53797374656D446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D342E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038391053797374656D446174614163636573730000000080CB01000400540E044E616D6514666E5F456D62656464696E67546F537472696E6754020F497344657465726D696E697374696301540209497350726563697365005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D342E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000080CC01000400540E044E616D6515666E5F456D62656464696E6744696D656E73696F6E54020F497344657465726D696E697374696301540209497350726563697365015455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D342E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000080CA01000400540E044E616D6513666E5F497356616C6964456D62656464696E6754020F497344657465726D696E697374696301540209497350726563697365015455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D342E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A4461746141636365737300000000000000000000009B7249FD00014D500200000076000000F02F0000F01100000000000000000000010000001300000027000000663000006612000000000000000000000000000010000000000000000000000000000000525344537A98FFBDD0E93B4E978E8BC07B7A735401000000433A5C4F534C5C436C617564655C526167436861744170705C526167436861744170705F5365727665725C44617461626173655C53716C436C725C6F626A5C52656C656173655C53716C566563746F7246756E6374696F6E732E70646200534841323536007A98FFBDD0E93B8E578E8BC07B7A73549B7249FDF2131F914061B208116B891FB53000000000000000000000CF300000002000000000000000000000000000000000000000000000C1300000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000000000FF25002000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000780300000000000000000000780334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000001000000000000000100000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004D8020000010053007400720069006E006700460069006C00650049006E0066006F000000B4020000010030003000300030003000340062003000000046001300010043006F006D00700061006E0079004E0061006D00650000000000530071006C0056006500630074006F007200460075006E006300740069006F006E007300000000004E0013000100460069006C0065004400650073006300720069007000740069006F006E0000000000530071006C0056006500630074006F007200460075006E006300740069006F006E00730000000000300008000100460069006C006500560065007200730069006F006E000000000031002E0030002E0030002E00300000004E001700010049006E007400650072006E0061006C004E0061006D0065000000530071006C0056006500630074006F007200460075006E006300740069006F006E0073002E0064006C006C00000000002800020001004C006500670061006C0043006F0070007900720069006700680074000000200000005600170001004F0072006900670069006E0061006C00460069006C0065006E0061006D0065000000530071006C0056006500630074006F007200460075006E006300740069006F006E0073002E0064006C006C0000000000460013000100500072006F0064007500630074004E0061006D00650000000000530071006C0056006500630074006F007200460075006E006300740069006F006E0073000000000082002F000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0030002B0034003400380063003000380033003000640031006100370062006600620035006200310062003500300031003900330035003300310066003200630061006400620039003700640030003100650066000000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0030002E0030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000C000000E43000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = SAFE;
GO

PRINT 'Assembly registered successfully!';
GO

-- Create functions
CREATE FUNCTION dbo.fn_CosineSimilarity(
    @embedding1 VARBINARY(MAX),
    @embedding2 VARBINARY(MAX)
)
RETURNS FLOAT
AS EXTERNAL NAME SqlVectorFunctions.SqlVectorFunctions.CosineSimilarity;
GO

CREATE FUNCTION dbo.fn_EmbeddingToString(
    @embedding VARBINARY(MAX),
    @maxValues INT
)
RETURNS NVARCHAR(MAX)
AS EXTERNAL NAME SqlVectorFunctions.SqlVectorFunctions.EmbeddingToString;
GO

CREATE FUNCTION dbo.fn_EmbeddingDimension(
    @embedding VARBINARY(MAX)
)
RETURNS INT
AS EXTERNAL NAME SqlVectorFunctions.SqlVectorFunctions.EmbeddingDimension;
GO

CREATE FUNCTION dbo.fn_IsValidEmbedding(
    @embedding VARBINARY(MAX)
)
RETURNS BIT
AS EXTERNAL NAME SqlVectorFunctions.SqlVectorFunctions.IsValidEmbedding;
GO

PRINT 'All CLR functions created successfully!';
GO